YUI.add("moodle-atto_embedquestion-button",function(e,t){var n="atto_embedquestion",r="atto-embedquestion-question-selector-wrapper",i="atto-embedquestion-submit-button";e.namespace("M.atto_embedquestion").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{currentSelection:null,doneOnce:!1,qForm:!1,thisHack:null,initializer:function(){var t,r;if(!this.get("enablebutton"))return;t=this.get("contextid"),r=this.get("elementid"),this.addButton({icon:"icon",iconComponent:n,callback:this.displayDialogue}),e.M.atto_embedquestion.form={},require(["atto_embedquestion/qform"],function(n){n.setContextId(t),e.M.atto_embedquestion.form[r]=n,e.M.atto_embedquestion.dialogue=!1}),thisHack=this,document.addEventListener("responseForYUI",this.insertQcode)},displayDialogue:function(){var t,i,s,o;this.currentSelection=this.get("host").getSelection(),t=M.util.image_url("y/loading"),i='<div class="'+r+'"><img class="icon " src="'+t+'" alt="Loading..." title="Loading..."></div>',e.M.atto_embedquestion.dialogue||(e.M.atto_embedquestion.dialogue=this.getDialogue({headerContent:M.util.get_string("pluginname",n),focusAfterHide:!0,bodyContent:i},!0)),e.M.atto_embedquestion.dialogue.show(),o=this.get("elementid"),this.doneOnce||(this.qForm=e.M.atto_embedquestion.form[o],this.qForm.setRootNode("."+r)),this.qForm.insertQform(),this.doneOnce||(this.doneOnce=!0)},insertQcode:function(t){var n,r;console.log(t),console.log(this),console.log(thisHack),console.log(e),thisHack.getDialogue({focusAfterHide:null}).hide(),n=thisHack.get("host"),n.setSelection(thisHack.currentSelection),n.insertContentAtFocusPoint(t.detail.code),thisHack.markUpdated()}},{ATTRS:{enablebutton:{value:!1},contextid:{value:!1},elementid:{value:!1}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
